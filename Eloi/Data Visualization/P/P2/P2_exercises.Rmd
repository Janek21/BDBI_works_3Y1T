---
title: "**Data visualization in R**<br><font color='#A8A8A8' size='5'>Reproducing `ggplot2` graphs</font><img src='https://www.construction21.org/espana/data/sources/users/8/images/logoesci-fons-blanc.png' style='position:absolute;top:0px;left:0px;' width='10%'/>"
author: "Marta Coronado Zamora"
date: "29 September 2023"
output:
  prettydoc::html_pretty:
    theme: leonids 
    highlight: github
        
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, fig.width = 6, fig.height = 4, fig.align='center')
# install.packages("prettydoc")
```

<style>
  @import url(https://fonts.googleapis.com/css?family=Fira+Sans:300,300i,400,400i,500,500i,700,700i);
  @import url(https://cdn.rawgit.com/tonsky/FiraCode/1.204/distr/fira_code.css);
  @import url("https://use.fontawesome.com/releases/v5.10.1/css/all.css");
  
  body {
    font-family: 'Fira Sans','Droid Serif', 'Palatino Linotype', 'Book Antiqua', Palatino, 'Microsoft YaHei', 'Songti SC', serif;
  }
  
  /* Make bold syntax compile to RU-red */
  strong {
    color: #cc0033;
  }
  
  .nav3 {
    height: auto;
    float: left;
    padding-left: 20px;
    padding-top: 20px;
    padding-right: 20px;
}
</style>



## Introduction

We are going to reproduce three different plots, of which we are only given the data set and the final image file. Each of them has two versions:

- The first version is a plot made just using the layer functions of `ggplot2` and leaving everything else with the defaults. This is, using `ggplot`, `geom_*`, `stat_*` and `annotate_*` functions (click on the image to see it bigger). 

<a href="http://bioinformatica.uab.cat/base/documents/sgbcursos/documents/p1_simple2020_10_4D11_52_42.png" target="new">
    <img src="http://bioinformatica.uab.cat/base/documents/sgbcursos/documents/p1_simple2020_10_4D11_52_42.png" alt="random image" width="30%">
</a><a href="http://bioinformatica.uab.cat/base/documents/sgbcursos/documents/p2_simple2022_10_2D10_14_44.png" target="new">
    <img src="http://bioinformatica.uab.cat/base/documents/sgbcursos/documents/p2_simple2022_10_2D10_14_44.png" alt="random image" width="30%">
</a> <a href="http://bioinformatica.uab.cat/base/documents/sgbcursos/documents/p3_simple2020_10_4D11_54_15.png" target="new">
    <img src="http://bioinformatica.uab.cat/base/documents/sgbcursos/documents/p3_simple2020_10_4D11_54_15.png" alt="random image" width="30%">
</a>

- The second version builds from the first plot to create a more complex display with customized `scales_*`, `coord_*`, `facet_*` or `theme_*`. Helper functions such as `labs()` or `guides()` could also be used (click on the image to see it bigger). 

<a href="http://bioinformatica.uab.cat/base/documents/sgbcursos/documents/p1_complete2022_10_2D10_14_29.png" target="new">
    <img src="http://bioinformatica.uab.cat/base/documents/sgbcursos/documents/p1_complete2022_10_2D10_14_29.png" alt="random image" width="30%">
</a> <a href="http://bioinformatica.uab.cat/base/documents/sgbcursos/documents/p2_complete2022_10_2D10_14_17.png" target="new">
    <img src="http://bioinformatica.uab.cat/base/documents/sgbcursos/documents/p2_complete2022_10_2D10_14_17.png" alt="random image" width="30%">
</a> <a href="http://bioinformatica.uab.cat/base/documents/sgbcursos/documents/p3_complete2022_10_2D10_13_8.png" target="new">
    <img src="http://bioinformatica.uab.cat/base/documents/sgbcursos/documents/p3_complete2022_10_2D10_13_8.png" alt="random image" width="30%">
</a>


```{r}
library(ggplot2)
```

&emsp;<i class="fas fa-info-circle"></i>: `ggplot2` will automatically load all three data sets used in this practical.

### Organization of the practical

You will see different icons through the document, the meaning of which is:

&emsp;<i class="fas fa-info-circle"></i>: additional or useful information<br>
&emsp;<i class="fas fa-search"></i>: a worked example<br>
&emsp;<i class="fa fa-cogs"></i>: a practical exercise<br>
&emsp;<i class="fas fa-comment-dots"></i>: a space to answer the exercise<br>
&emsp;<i class="fa fa-key"></i>: a hint to solve an exercise<br>
&emsp;<i class="fa fa-rocket"></i>: a more challenging exercise<br><br>

----------------------------------------------------------------------------------

## **<i class="fa fa-cogs"></i> Simple versions**

### **Plot 1**

```{r answer1.1}
# Dataset used: diamonds
library(ggplot2)
data <- data("diamonds")

ggplot(diamonds, aes(clarity, log10(carat))) + 
  geom_jitter(mapping = aes(clarity, log10(carat), colour = cut)) +
  geom_violin(fill = "black", color = "black") +
  labs(x = "Clarity", y = "log10(Carat)", color = "Cut")


```

<div style="background-color:#F0F0F0">
##### &emsp;<i class="fas fa-comment-dots"></i> Answer:
&emsp;
</div>

### **Plot 2**

```{r answer1.2}
library(ggplot2)
ggplot(mpg, aes(manufacturer, fill = class))+
  geom_bar() +
  geom_text(stat = "count", aes(label = after_stat(count)), 
            position = position_stack(vjust = 0.5)) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))


```


&emsp;<i class="fa fa-key"></i> Need help with the count numbers shown in each stacked bar? https://stackoverflow.com/questions/6644997/showing-data-values-on-stacked-bar-chart-in-ggplot2

<div style="background-color:#F0F0F0">
##### &emsp;<i class="fas fa-comment-dots"></i> Answer:
&emsp;
</div>

### **Plot 3**

```{r answer1.3}
# Dataset: ToothGrowth
ggplot(ToothGrowth, aes(factor(dose), len))+
  geom_boxplot(mapping = aes( fill = supp))+ 
  geom_hline(yintercept = mean(ToothGrowth$len)) + 
  annotate("text",x = 1,y = 20, label ="Mean")
  
```

<div style="background-color:#F0F0F0">
##### &emsp;<i class="fas fa-comment-dots"></i> Answer:
&emsp;
</div>

----------------------------------------------------------------------------------

## **<i class="fa fa-rocket"></i> Complex versions**

### **Plot 1**

```{r answer2.1}

ggplot(diamonds, aes(x = clarity, y = log10(carat), color = cut)) +
  geom_jitter(mapping = aes(alpha = 1)) + 
  geom_violin(aes(fill = cut), scale = "width", fill = "black", colour = "black") + 
  facet_wrap(~cut, nrow = 1) +  # Facet by cut
  labs(title = "Diamond quality", y = "log10(Carat)", x = "clarity")+
  theme_bw()+
  theme(legend.position = "None",axis.text.x = element_text(angle = 45, hjust = 1, size = 6),)
```

<div style="background-color:#F0F0F0">
##### &emsp;<i class="fas fa-comment-dots"></i> Answer:
&emsp;
</div>

### **Plot 2**

```{r answer2.2}
ggplot(mpg, aes(manufacturer, fill = class)) +
  geom_bar() +
  geom_text(stat = "count", aes(label = after_stat(count)), 
            position = position_stack(vjust = 0.5), color = "black") +
  scale_fill_brewer(type = "qual",palette = 2)+
  theme_minimal()+
  coord_flip() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  labs(x = "Manufacturer", y = "Number of Cars", fill = "Car Type") 
```

<div style="background-color:#F0F0F0">
##### &emsp;<i class="fas fa-comment-dots"></i> Answer:
&emsp;
</div>


&emsp;<i class="fa fa-key"></i> This graph uses a `scale_fill_brewer` palette, can you find which one?

### **Plot 3**

```{r answer2.3}
ggplot(ToothGrowth, aes(factor(dose), len))+
  geom_boxplot(mapping = aes( fill = supp))+ 
  geom_hline(yintercept = mean(ToothGrowth$len), linetype = "dashed") + 
  annotate("text",x = 1,y = 20, label ="Mean") +  
  labs(x = "Dose (mg/day)", y = "Tooth length", fill = "Supplement", caption = "Source: ToothGrowth dataset") +
  scale_fill_manual(
    values = c("OJ" = "#FFA500", "VC" = "#FFCC80"),  # Custom colors
    labels = c("OJ" = "Orange Juice", "VC" = "Vitamin C" )) +
  theme_classic()

  
```

<div style="background-color:#F0F0F0">
##### &emsp;<i class="fas fa-comment-dots"></i> Answer:
&emsp;
</div>

&emsp;<i class="fa fa-key"></i> This graph uses a `scale_fill_brewer` palette, can you find which one?
